<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectSent Viewer</title>
    <!-- Favicon from previous submission -->
    <link rel="icon" type="image/png" href="icon.png">
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <!-- Bootstrap Icons CDN for consistent iconography -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts for 'Sora' typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- External Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-theme-background dark:bg-darkTheme-background text-theme-text-primary dark:text-darkTheme-text-primary antialiased min-h-screen flex flex-col items-center justify-center p-3 transition-colors duration-300 ease-custom-ease font-sans">
    
    <div class="w-full max-w-4xl md:max-w-5xl lg:max-w-6xl mx-auto px-4 sm:px-6 bg-theme-surface dark:bg-darkTheme-surface rounded-lg shadow-subtle dark:shadow-subtle-dark mb-4 border border-theme-border dark:border-darkTheme-border transition-colors duration-300 ease-custom-ease">
        
        <!-- Header Section -->
        <header class="flex flex-col sm:flex-row items-center justify-between gap-2 mb-4 md:mb-6 py-4">
            <!-- Button Row - Always on top -->
            <div class="flex justify-between items-center w-full z-10">
                <!-- Left Button Group -->
                <div class="flex items-center gap-2">
                    <a href="https://tcd-raingutter.netlify.app/" aria-label="Back to home" title="Back to Home" 
                       class="p-1 rounded-full bg-theme-surface dark:bg-darkTheme-surface text-theme-text-primary dark:text-darkTheme-text-primary hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent transition-colors duration-200">
                        <i class="bi bi-house-door text-lg"></i>
                    </a>
                    <button id="refreshBtn" aria-label="Refresh page" title="Refresh Page" 
                            class="p-1 rounded-full bg-theme-surface dark:bg-darkTheme-surface text-theme-text-primary dark:text-darkTheme-text-primary hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent transition-colors duration-200">
                        <i class="bi bi-arrow-clockwise text-lg"></i>
                    </button>
                    <button id="closeWindowBtn" aria-label="Close window" title="Close Window" 
                            class="p-1 rounded-full bg-theme-surface dark:bg-darkTheme-surface text-theme-text-primary dark:text-darkTheme-text-primary hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent transition-colors duration-200">
                        <i class="bi bi-x-lg text-lg"></i>
                    </button>
                </div>

                <!-- Theme Toggle Button - Right side in mobile -->
                <div class="w-12 h-12">
                     <button id="themeToggleBtn" aria-label="Toggle theme" title="Toggle Theme"
                        class="p-1 rounded-full bg-theme-surface dark:bg-darkTheme-surface text-theme-text-primary dark:text-darkTheme-text-primary hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent transition-colors duration-200 sm:hidden">
                        <i class="bi bi-moon-fill icon-moon text-lg"></i>
                        <i class="bi bi-sun-fill icon-sun text-lg hidden"></i>
                    </button>
                </div>

            </div>

            <!-- Title Section - Below buttons in mobile, centered in desktop -->
            <div class="w-full sm:absolute sm:left-1/2 sm:transform sm:-translate-x-1/2 text-center">
                <h1 class="text-lg sm:text-xl font-bold text-theme-text-primary dark:text-darkTheme-text-primary mb-1">☔ RAIN GUTTER DEPT TOOLS</h1>
                <p class="text-theme-text-muted dark:text-darkTheme-text-muted text-xs">EMAIL SENT CHECKER</p>
            </div>

            <!-- Theme Toggle Button - Only visible on desktop -->
            <div class="hidden sm:block z-10 w-12 h-12">
                 <button id="themeToggleBtnDesktop" aria-label="Toggle theme" title="Toggle Theme" 
                        class="p-1 rounded-full bg-theme-surface dark:bg-darkTheme-surface text-theme-text-primary dark:text-darkTheme-text-primary hover:bg-opacity-70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent transition-colors duration-200">
                    <i class="bi bi-moon-fill icon-lg icon-moon"></i>
                    <i class="bi bi-sun-fill icon-lg icon-sun hidden"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Container -->
        <div class="bg-theme-surface dark:bg-darkTheme-surface p-4 rounded-lg shadow-subtle dark:shadow-subtle-dark mb-4 border border-theme-border dark:border-darkTheme-border transition-colors duration-300 ease-custom-ease">
            <h3 class="text-base font-semibold text-theme-text-primary dark:text-darkTheme-text-primary text-center mb-2">Image Text Extractor</h3>
            <p class="text-theme-text-muted dark:text-darkTheme-text-muted text-xs text-center">Upload an image or **paste** a screenshot (Ctrl+V or Cmd+V).</p>
            <div class="upload-section mt-4 p-4 flex flex-col items-center justify-center border-2 border-dashed border-theme-border dark:border-darkTheme-border rounded-lg transition-colors duration-300 ease-custom-ease">
                <input type="file" id="imageInput" accept="image/*" class="file-input hidden" multiple>
                <label for="imageInput" class="file-label px-3 py-1.5 bg-theme-accent text-theme-accent-contrast rounded-md text-sm font-semibold hover:bg-opacity-90 transition-all duration-200 ease-custom-ease">Choose Images</label>
                <div class="text-theme-text-muted dark:text-darkTheme-text-muted text-xs my-2">or drag and drop here</div>
                <div id="previewsContainer" class="thumbnail-container"></div>
                <button id="extractButton" class="button primary px-5 py-2 mt-3 bg-theme-accent text-theme-accent-contrast rounded-md text-sm font-semibold hover:bg-opacity-90 transition-all duration-200 ease-custom-ease flex items-center justify-center gap-2">
                    Extract Text <span id="loadingSpinner" class="spinner"></span>
                </button>
            </div>
        </div>
        
        <hr class="border-t border-theme-border dark:border-darkTheme-border my-2">

        <div class="bg-theme-surface dark:bg-darkTheme-surface p-4 rounded-lg shadow-subtle dark:shadow-subtle-dark mb-4 border border-theme-border dark:border-darkTheme-border transition-colors duration-300 ease-custom-ease">
            <h2 class="text-base font-semibold text-theme-text-primary dark:text-darkTheme-text-primary text-center mb-2">Saved Data</h2>
            
            <!-- Search bar -->
            <div class="flex items-center w-full max-w-md mx-auto mb-2">
                <input type="text" id="searchBar" placeholder="Search by Project Number or Name..." class="w-full px-3 py-2 rounded-md border border-theme-border dark:border-darkTheme-border focus:outline-none focus:ring-2 focus:ring-theme-accent dark:focus:ring-darkTheme-accent bg-theme-surface dark:bg-darkTheme-surface text-sm placeholder-theme-text-muted dark:placeholder-darkTheme-text-muted">
            </div>
            
            <div class="overflow-x-auto overflow-y-auto max-h-96">
                <table id="dataTable" class="w-full data-table border-collapse">
                    <thead>
                        <tr class="bg-theme-border dark:bg-darkTheme-border sticky top-0">
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary">Project Number</th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary">Project Name</th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary">Building No.</th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary cursor-pointer hover:bg-theme-accent hover:bg-opacity-20" onclick="sortTable('colD')">Sent Date <span id="colD-sort-icon" class="ml-1 text-xs"></span></th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary cursor-pointer hover:bg-theme-accent hover:bg-opacity-20" onclick="filterThunderbirdSent()">Thunderbird Sent <span id="thunderbirdSent-filter-icon" class="ml-1 text-xs"></span></th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary cursor-pointer hover:bg-theme-accent hover:bg-opacity-20" onclick="sortTable('thunderbirdDate')">Thunderbird Date <span id="thunderbirdDate-sort-icon" class="ml-1 text-xs"></span></th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary">Notes</th>
                            <th class="py-1 px-2 font-semibold text-left text-xs text-theme-text-primary dark:text-darkTheme-text-primary">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-theme-border dark:divide-darkTheme-border"></tbody>
                </table>
            </div>
            
            <!-- Footer Section -->
            <footer class="text-center mt-3 pt-3 border-t border-theme-border dark:border-darkTheme-border">
                <p class="text-theme-text-muted dark:text-darkTheme-text-muted text-xs uppercase tracking-widest">&copy; 2025 RAIN GUTTER DEPARTMENT.</p>
            </footer>
        </div>
    </div>
    

    <!-- Modal for Extracted Data Preview -->
    <div id="previewModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="text-lg font-semibold text-theme-text-primary dark:text-darkTheme-text-primary">Extracted Data Preview</h3>
                <button id="closeModalButton" class="modal-close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="overflow-y-auto max-h-[50vh]">
                    <table id="previewTable" class="w-full data-table border-collapse">
                        <thead>
                            <tr class="bg-theme-border dark:bg-darkTheme-border">
                                <th class="py-2 px-3 font-semibold text-left text-sm text-theme-text-primary dark:text-darkTheme-text-primary">Project Number</th>
                                <th class="py-2 px-3 font-semibold text-left text-sm text-theme-text-primary dark:text-darkTheme-text-primary">Project Name</th>
                                <th class="py-2 px-3 font-semibold text-left text-sm text-theme-text-primary dark:text-darkTheme-text-primary">Building No.</th>
                                <th class="py-2 px-3 font-semibold text-left text-sm text-theme-text-primary dark:text-darkTheme-text-primary">Sent Date</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-theme-border dark:divide-darkTheme-border"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveButton" class="button primary px-5 py-2.5 bg-theme-success text-white rounded-md text-sm font-semibold hover:bg-opacity-90 transition-all duration-200 ease-custom-ease">Save to Database</button>
            </div>
        </div>
    </div>

    <!-- View Details Modal -->
    <div id="viewModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="text-lg font-semibold text-theme-text-primary dark:text-darkTheme-text-primary">View Details</h3>
                <button id="closeViewModalButton" class="modal-close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Project Number</label>
                        <p id="viewColA" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Project Name</label>
                        <p id="viewColB" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Building No.</label>
                        <p id="viewColC" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Sent Date</label>
                        <p id="viewColD" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Thunderbird Sent</label>
                        <p id="viewThunderbirdSent" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Thunderbird Date</label>
                        <p id="viewThunderbirdDate" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Notes</label>
                        <p id="viewNotes" class="px-3 py-2 bg-theme-surface dark:bg-darkTheme-surface rounded border border-theme-border dark:border-darkTheme-border text-sm"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeViewButton" class="px-4 py-2 bg-theme-text-muted text-white rounded-md text-sm font-semibold hover:bg-opacity-80 transition-all">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="text-lg font-semibold text-theme-text-primary dark:text-darkTheme-text-primary">Edit Record</h3>
                <button id="closeEditModalButton" class="modal-close-button">&times;</button>
            </div>
            <div class="modal-body">
                <div class="space-y-3">
                    <div>
                        <label for="editColA" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Project Number</label>
                        <input type="text" id="editColA" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent">
                    </div>
                    <div>
                        <label for="editColB" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Project Name</label>
                        <input type="text" id="editColB" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent">
                    </div>
                    <div>
                        <label for="editColC" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Building No.</label>
                        <input type="text" id="editColC" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent">
                    </div>
                    <div>
                        <label for="editColD" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Sent Date</label>
                        <input type="text" id="editColD" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent">
                    </div>
                    <div>
                        <label for="editThunderbirdSent" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Thunderbird Sent</label>
                        <select id="editThunderbirdSent" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent">
                            <option value="">Not Sent</option>
                            <option value="✅">Sent ✅</option>
                        </select>
                    </div>
                    <div>
                        <label for="editThunderbirdDate" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Thunderbird Date</label>
                        <input type="text" id="editThunderbirdDate" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent">
                    </div>
                    <div>
                        <label for="editNotes" class="block text-xs font-semibold text-theme-text-muted dark:text-darkTheme-text-muted mb-1">Notes</label>
                        <textarea id="editNotes" class="w-full px-3 py-2 border border-theme-border dark:border-darkTheme-border rounded-md bg-theme-surface dark:bg-darkTheme-surface text-sm focus:outline-none focus:ring-2 focus:ring-theme-accent resize-none" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelEditButton" class="px-4 py-2 bg-theme-text-muted text-white rounded-md text-sm font-semibold hover:bg-opacity-80 transition-all">Cancel</button>
                <button id="saveEditButton" class="px-4 py-2 bg-theme-success text-white rounded-md text-sm font-semibold hover:bg-opacity-80 transition-all">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="text-lg font-semibold text-theme-text-primary dark:text-darkTheme-text-primary">Delete Record</h3>
                <button id="closeDeleteModalButton" class="modal-close-button">&times;</button>
            </div>
            <div class="modal-body">
                <p class="text-theme-text-primary dark:text-darkTheme-text-primary text-sm">Are you sure you want to delete this record? This action cannot be undone.</p>
                <p class="mt-3 p-3 bg-theme-border dark:bg-darkTheme-border rounded text-theme-text-primary dark:text-darkTheme-text-primary text-sm font-semibold">
                    <span id="deleteProjectInfo"></span>
                </p>
            </div>
            <div class="modal-footer">
                <button id="cancelDeleteButton" class="px-4 py-2 bg-theme-text-muted text-white rounded-md text-sm font-semibold hover:bg-opacity-80 transition-all">Cancel</button>
                <button id="confirmDeleteButton" class="px-4 py-2 bg-theme-error text-white rounded-md text-sm font-semibold hover:bg-opacity-80 transition-all">Delete</button>
            </div>
        </div>
    </div>

    <!-- Inline JavaScript removed - moved to script.js -->
    <script></script>
    
    <!-- External JavaScript -->
    <script src="script.js"></script>
</body>
</html>
